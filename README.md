# みんなで備える防災備蓄マップ

避難所の防災備蓄状況を登録・表示できるオープンソーステンプレートです。

## 想定ユーザー

- サイト運営者は、避難所の防災備蓄状況ファイルを各所から集め、データを定期的に更新して頂けるシビックテックボランティアの方を想定しています
- サイト利用者は、避難所の防災備蓄状況を参照することができます

## サンプルサイト

https://bichiku-map.web.app/

## テンプレート利用方法とサイト運営手順

### テンプレートを準備

- GitHub のアカウントを作成し、本リポジトリをフォークしてください
- フォークする手順は[こちら](https://docs.github.com/ja/get-started/quickstart/fork-a-repo)を参照してください

### 避難所の防災備蓄状況ファイルの作成方法

- 避難所毎に防災備蓄状況ファイルを作成してください。

  - サンプルは backend/upload フォルダの 佃島小学校（東京都中央区佃 2-3-1）.csv と 京橋築地小学校（東京都中央区築地 2-13-1）.csv です
  - ファイル名の避難所名称と住所は[東京都防災マップ 避難所・避難場所(CC BY 4.0)](https://catalog.data.metro.tokyo.lg.jp/dataset/t000003d0000000093)の名称に合わせてください。元データに ID が無いため避難所名称と住所で名寄せしています。
  - 防災備蓄品種類（62 種）は[東京備蓄ナビ(MIT License)](https://www.bichiku.metro.tokyo.lg.jp/download/)のリストを使用しています。
  - id,備蓄品名,カテゴリー名の列は変更しないでください。id で東京備蓄ナビのリストと突合しています。
  - 現在備蓄量,不足備蓄量,更新日列を最新化してください。最新のデータのみ表示されます。1 行目の更新日を避難所の更新日として扱っています。
  - 文字コードは UTF-8 にしてください。

- 避難所毎に「避難所名称（住所）.csv」というファイル名で保存して backend/upload フォルダに格納してください。
  - サイト運営者は各避難所の防災備蓄状況ファイルを各所から集めてください。

#### 避難所名称（住所）.csv フォーマット

```
id,備蓄品名,カテゴリー名,現在備蓄量,不足備蓄量,更新日
1,水,食品,0,0,2022/03/11
2,レトルトご飯,食品,0,0,2022/03/11
3,レトルト食品,食品,0,0,2022/03/11
```

### 避難所の防災備蓄データを登録

- 避難所毎の防災備蓄状況ファイルから表示データを更新するバッチ処理を動かします。

```
cd backend
npm install
npm run etl
```

### 防災備蓄マップを公開

- React web application をビルドし Firebase にデプロイしてください。
  - Production: Firebase 環境は各自でご準備ください。Github Actions でデプロイします。
  - Development: ローカル PC 環境で起動します。

```
cd frontend
npm install
npm run start
npm run build
```

## オープンデータ・オープンソース

### 東京都オープンデータカタログサイト
[東京都提供の「避難所、避難場所データ オープンデータ」(CC BY 4.0)](https://catalog.data.metro.tokyo.lg.jp/dataset/t000003d0000000093)を利用しています。

### 東京備蓄ナビ
[東京備蓄ナビのオープンソース(MIT License)](https://www.bichiku.metro.tokyo.lg.jp/download/)を利用しています。
